# 网络协议

#### 计算机网络体系结构

计算机网络的各层及其协议的集合，称为网络的体系结构。

1. **OSI七层网络模型：**开放式系统互联参考模型  
   它把网络从逻辑上分为了7层。建立七层模型的主要目的是为解决异种网络互连时所遇到的兼容性问题，其最主要的功能使就是帮助不同类型的主机实现数据传输。它的最大优点是将服务、接口和协议这三个概念明确地区分开来，通过七个层次化的结构模型使不同的系统不同的网络之间实现可靠的通讯。

   1. 物理层  
      最低层，主要定义物理设备标准，如网线的接口类型、光纤的接口类型、各种传输介质的传输速率等。它的主要作用是传输比特流。

   2. 数据链路层 【转发 在数据链路层】  
      第二层，它控制网络层与物理层之间的通信。它的主要功能是如何在不可靠的物理线路上进行数据的可靠传递。

   3. 网络层         【路由在 网络层】  
      第三层，其主要功能是将网络地址翻译成对应的物理地址，并决定如何将数据从发送方路由到接收方。

   4. 传输层  
      最重要的一层。定义了一些传输数据的协议和端口号，主要是将从下层接收的数据进行分段和传输，到达目的地址后再进行重组。

   5. 会话层  
      负责在网络中的两节点之间建立、维持和终止通信。 通过传输层（端口号：传输端口与接收端口）建立数据传输的通路。主要在你的系统之间发起会话或者接受会话请求。

   6. 表示层  
      可确保一个系统的应用层所发送的信息可以被另一个系统的应用层读取。

   7. 应用层  
      是最靠近用户的OSI层。这一层为用户的应用程序（例如电子邮件、文件传输和终端仿真）提供网络服务。。![](/assets/5d6034a85edf8db11430f4470b23dd54564e74f3.jpg)

2. **TCP/IP四层模型：  **TCP/IP参考模型

   1. 网络接口层  
         实际上TCP/IP参考模型没有真正描述这一层的实现，只是要求能够提供给其上层一个访问接口，以便在其上传递IP分组

   2. 网络互联层  
      它的功能是把分组发往目标网络或主机。主要解决主机到主机的通信问题。

   3. 传输层  
      为应用层实体提供端到端的通信功能，保证了数据包的顺序传送及数据的完整性。

   4. 应用层  
      为用户提供所需要的各种服务，例如：FTP、Telnet、DNS、SMTP等。

![](/assets/80cb39dbb6fd5266417d403ca918972bd4073647.jpg)

1. **五层模型**  
   物理层 - 数据链路层 - 网络层 - 传输层 - 应用层

#### 网络协议

TCP和UDP使用IP协议从一个网络传送数据包到另一个网络。把IP想像成一种高速公路，它允许其它协议在上面行驶并找到到其它电脑的出口。TCP和UDP是高速公路上的“卡车”，它们携带的货物就是像HTTP，文件传输协议FTP这样的协议等。

1. **HTTP**     应用层
   超文本传输协议。是利用TCP在两台电脑之间传输信息的协议，默认端口号是80。
   无状态的协议：每个请求都是独立的。
2. **TCP **      传输层
   传输控制协议。
   1. TCP提供有保证的数据传输，确保数据可靠。
   2. TCP是面向连接的协议，也就是说，在收发数据前，必须和对方建立可靠的连接。
   3. **使用TCP的应用**：Web浏览器；电子邮件、文件传输程序、远程登录。（**效率要求相对低，但对准确性要求相对高的场景**）
3. **UDP**       传输层
   用户数据报协议。
   1. UDP不能保证数据可靠交付。
   2. UDP是面向报文的。非连接的协议，传输数据之前源端和终端不建立连接，当它想传送时就简单地去抓取来自应用程序的数据。UDP信息包的标题很短,比TCP信息包额外开销小。
   3. UDP 支持多播和广播。
   4. 使用UDP的应用：QQ聊天、在线视频、网络语音电话。（效率要求相对高，对准确性要求相对低的场景）
4. **IP   **        网络层
   网络层协议。网络层提供点到点的连接即提供主机之间的逻辑通信，传输层提供端到端的连接——提供进程之间的逻辑通信。
5. **HTTPS**  
   安全超文本传输协议。它使用安全套接字层\(SSL\)进行信息交换，简单来说它是HTTP的安全版。默认端口443。

   加密实现： HTTPS其实是有两部分组成：HTTP + SSL / TLS，也就是在HTTP上又加了一层处理加密信息的模块。服务端和客户端的信息传输都会通过TLS进行加密，所以传输的数据都是加密后的数据。

6. **TCP/IP**：是一个协议簇。  
   TCP 负责应用软件（比如你的浏览器）和网络软件之间的通信。IP负责计算机之间的通信。TCP负责将数据分割并装入IP包，IP负责将包发送至接受者，传输过程要经IP路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址，然后在它们到达的时候重新组合它们。

   1. **TCP提供应用程序之间的通讯**。TCP确保数据包以正确的次序到达，并且尝试确认数据包的内容没有改变。

   2. **IP提供计算机之间的通讯**。  
      通过 IP协议，消息被分割为小的独立的包，并通过因特网在计算机之间传送。IP负责将每个包路由至它的目的地。IP协议仅仅是允许计算机相互发消息，但它并不检查消息是否以发送的次序到达而且没有损坏。

#### HTTP和HTTPS区别

1. http是HTTP协议运行在TCP之上。所有传输的内容都是**明文**，客户端和服务器端都无法验证对方的身份。
   https是HTTP运行在SSL/TLS之上，SSL/TLS运行在TCP之上。所有传输的内容都经过**加密**，客户端可以验证服务器端的身份。
2. https协议**需要到申请证书**，一般免费证书很少，需要交费。
3. http和https使用的是完全不同的连接方式，用的**端口也不一样**,前者是80,后者是443。
4. http的连接很简单,是**无状态**的。

#### TCP和UDP区别

1. TCP基于连接，UDP无连接
2. TCP对系统资源的要求较多，UDP较少
3. TCP流模式（一次传输大量数据）,UDP是数据报模式
4. TCP保证数据可靠性，UDP可能丢包，TCP保证数据顺序，UDP不保证。
5. TCP有拥塞控制，UDP无拥塞控制
6. TCP 是一个字节流协议，没有任何（协议上的）记录边界。UDP 数据报是有长度的。每个 UDP 数据报都有长度。

7. UDP 支持多播和广播。

#### HTTP和TCP的区别

1. Http是应用层协议，**主要解决如何包装数据**
2. TCP是传输层协议，**主要解决数据如何在网络中传输**
3. HTTP协议是建立在TCP协议之上的一种应用，Http使用Tcp保证传输可靠性和完整性。

#### TCP为什么可靠

1）**TCP将数据截取为合理的长度**：TCP将应用数据分割成认为最适合发送的数据块。UDP完全不同，在UDP中应用程序产生的数据报长度将保持不变。

2）**TCP的超时重发机制**：TCP发出数据流之后会等待接收方发出响应确认信号，如果发送方不能及时收到确认信号会重新再次发送数据报。

3）**对于收到的请求，给出确认响应**：当TCP收到发自TCP连接另一端的数据，它将发送一个确认。这个确认不是立即发送，通常将推迟几分之一秒 。

4）TCP会校验数据报，如果检测出数据包有错，就丢弃报文段，不给出响应。

5）对失效数据进行重排序然后才交给应用层：既然TCP报文段作为IP数据报来传输，而IP数据报的到达可能会失序，因此TCP报文段的到达也可能会失序。如果必要，TCP将对收到的数据进行重新排序，将收到的数据以正确的顺序交给应用层。

6）对于重复数据，能够丢弃重复数据：既然IP数据报会发生重复，TCP的接收端必须丢弃重复的数据。

7）**TCP还能提供流量控制，防止较快主机导致较慢主机的缓冲区溢出**：TCP连接的每一方都有固定大小的缓冲空间。TCP的接收端只允许另一端发送接收端缓冲区所能接纳的数据。这将防止较快主机致使较慢主机的缓冲区溢出。

#### TCP重传机制

如果发生阻塞，发出去的请求包在规定时间内没有收到ACK，不管是请求包丢失，还是ACK包丢失，还是网络延迟，总之，这里都是需要重传机制。

TCP的重传机制有两种：**超时重传和快速重传**。

1. **超时重传**：在请求包发出去的时候，开启一个计时器，当计时器达到时间之后，没有收到ACK，则就进行重发请求的操作，一直重发直到达到重发上限次数或者收到ACK。
2. **快速重传**：当接收方收到的数据包是不正常的序列号，那么接收方会重复把应该收到的那一条ACK重复发送，这个时候，如果发送方收到连续3条的同一个序列号的ACK，那么就会启动快速重传机制，把这个ACK对应的发送包重新发送一次。

#### TCP流量控制和拥塞控制

1. 流量控制  
   让发送方的发送速率不要太快，让接收方来得及接受。利用滑动窗口机制可以很方便的在TCP连接上实现对发送方的流量控制。TCP的窗口单位是字节，不是报文段，发送方的发送窗口不能超过接收方给出的接收窗口的数值。流量控制往往指的是点对点通信量的控制，是个端到端的问题。流量控制所要做的就是控制发送端发送数据的速率，以便使接收端来得及接受。

   1. 

2. 拥塞控制  
   在某段时间，若对网络中的某一资源的需求超过了该资源所能提供的可用部分，网络的性能就要变化，这种情况叫做**拥塞**。

   **拥塞控制：**就是防止过多的数据注入到网络中，这样可以使网络中的路由器或链路不致过载。拥塞控制所要做的都有一个前提，就是网络能承受现有的网络负荷。拥塞问题是一个全局性的问题,涉及到所有的主机、所有的路由器、以及与降低网络传输性能有关的所有因素。

   1. **慢开始**：当新建连接时，cwnd初始化为1个最大报文段\(MSS\)大小，发送端开始按照拥塞窗口大小发送数据，每当有一个报文段被确认，cwnd就增加至多1个MSS大小。用这样的方法来逐步增大拥塞窗口CWND。

      ```
      当cwnd<ssthresh时，使用慢开始算法。
      当cwnd>ssthresh时，改用拥塞避免算法。
      当cwnd=ssthresh时，慢开始与拥塞避免算法任意。
      ```

   2. **拥塞避免**：让拥塞窗口缓慢增长，即每经过一个往返时间RTT就把发送方的拥塞窗口cwnd加1，而不是加倍。这样拥塞窗口按线性规律缓慢增长。

      ```
      乘法减小：是指不论在慢开始阶段还是拥塞避免阶段，只要出现超时，就把慢开始门限减半，即设置为当前的拥塞窗口的一半
      （于此同时，执行慢开始算法）。当网络出现频繁拥塞时，ssthresh值就下降的很快，以大大将小注入到网络中的分组数。
      加法增大：是指执行拥塞避免算法后是拥塞窗口缓慢增大，以防止网络过早出现拥塞。
      ```

   3. **快重传**：快重传算法规定，发送方只要一连收到三个重复确认就应当立即重传对方尚未收到的报文段，而不必继续等待设置的重传计时器时间到期。

   4. **快恢复**：当发送方连续收到三个重复确认时，就执行“乘法减小”算法，把ssthresh门限减半。但是接下去并不执行慢开始算法。

#### 路由寻址

1. 搜索路由表，寻找能与目的IP地址完全匹配的表目。如果找到，则把报文发送给该表目指定的下一站路由器或直接连接的网络接口。
2. 搜索路由表，寻找能与目的网络号相匹配的表目。如果找到，则把报文发送给该表目指定的下一站路由器或直接连接的网络接口。
3. 搜索路由表，寻找default表目。如果找到，则把报文发送给该表目指定的下一站路由器。



