### Cookie

Cookie实际上是一小段的文本信息。客户端请求服务器，如果服务器需要记录该用户状态，就产生一个用户身份标识，然后在响应消息中将该标识号以Cookie的形式传递给浏览器.客户端浏览器会把Cookie保存起来。浏览器在以后每次访问该web服务器时，浏览器把请求的网址连同该Cookie一同提交给服务器。服务器检查该Cookie，以此来辨认用户状态。服务器还可以根据需要修改Cookie的内容. Cookie不能被浏览器共享 Cookie具有不可跨域名性，例如浏览器访问Google只会携带Google的Cookie，而不会携带Baidu的Cookie。Cookie的maxAge决定着Cookie的有效期，单位为秒（Second）。默认情况下,cookie是一个会话级别的,用户退出浏览器后被删除

### Session

Session是另一种记录客户状态的机制，不同的是Cookie保存在客户端浏览器中，而Session保存在服务器上。客户端浏览器访问服务器的时候，服务器把客户端信息以某种形式记录在服务器上。这就是Session。 如果说Cookie机制是通过检查客户身上的“通行证”来确定客户身份的话，那么Session机制就是通过检查服务器上的“客户明细表”来确认客户身份。Session相当于程序在服务器上建立的一份客户档案，客户来访的时候只需要查询客户档案表就可以了。 Session保存在服务器端。为了获得更高的存取速度，服务器一般把Session放在内存里。每个用户都会有一个独立的Session。如果Session内容过于复杂，当大量客户访问服务器时可能会导致内存溢出。因此，Session里的信息应该尽量精简。

#### session工作原理

1. web不会在客户端开始访问它时创建session,在访问特殊的程序并且该程序\(servlet\)决定与客户端开启会话时,服务器生成一个唯一值,称为Session ID。服务器开辟一块内存，对应于该Session ID。
2. 服务器再将该Session ID写入浏览器的cookie。
3. 服务器内有一进程，监视所有Session的活动状况，如果有Session超时或是主动关闭，服务器就释放改内存块。
4. 当浏览器连入服务器时并请求Session时，服务器就读浏览器Cookie中的Session ID。
5. 然后，服务检查该Session ID所对应的内存是否有效。 
6. 如果有效，就读出内存中的值。 
7. 如果无效，就建立新的Session。

生命周期：

1. tomcat默认是30分钟 
2. 因为session和cookie有关系，客户端浏览器通过cookie维持该会话，cookie不支持跨浏览器共享，意味着如果把浏览器关该会闭的话该会话就会失效\(但服务端还保存着\)。因此同一机器的两个浏览器窗口访问服务器时，会生成两个不同的Session。

#### Cookie和Session区别

1）cookie保存在客户端，session保存在服务器端；

2）cookie可以跟踪会话，也可以保存用户喜好或者保存用户名密码；session用来跟踪会话。

3）cookie不是很安全，别人可以分析存放在本地的cookie并进行cookie欺骗，考虑到安全应当使用session。

4）session会在一定时间内保存在服务器上。当访问增多，会比较占用你服务器的性能，考虑到减轻服务器性能方面，应当使用cookie。

#### 服务端session是如何标识已登录的用户的？

http是无状态的会话，需要基于http协议支持会话状态的机制。这时候引入session，在会话开始时，分配一个唯一的会话标识（sessionId），通过cookie把这个标识告诉浏览器，以后每次请求的时候，浏览器的cookie都会带上这个会话ID来告诉web服务器请求是属于哪个会话的。这也是为什么禁用了cookie之后，每次操作都需要先登录。在web服务器上各个会话有独立的存储，保存不同会话的信息。

**对于上万个用于已经登录了，服务端是怎么分辨每个用户的？**

1. 服务器在响应头内加上”set-Cookie:XXXXXXXXXXXXX“\(相当于一个唯一的ID符\)，此信息是服务器随机生成的，放在服务器内存里，不会重复,这就是sessionid。
2. 当浏览器得到这个sessionId会将它放在自己的进程内存里,.然后你继续发请求给这个网站的时候,浏览器就会把这个sessionId放在请求头里发送给该服务器了,这样服务器得到sessionId后再和自己内存里存放的sessionid对比锁定客户端,从而区分不同客户端,完成会话。
3. 关闭浏览器结束进程,则这个sessionid将消失,如果用户又打开浏览器想继续这次会话的时候,就会因为发送的请求中没有这个sessionid，而使服务器无法辨别请求身份。

### **session是存储在什么地方，以什么形式存储的？**

1）session变量保存在web服务器中，你不能直接修改，当然，调用程序中的setAttribute\(\)方法当然可以了。cookie存储的不是具体的数据，要不岂不是太不安全了，谁都可以修改session变量了，网站也毫无安全性可言。实际，在cookie中，存储的是一个sessionId，它标示了一个服务器中的session变量，通过这种方式，服务器就知道你到底是那个session了。所以，记住客户端只存储session标识，实际内容在网页服务器中。

2）以键值对的方式存储的

